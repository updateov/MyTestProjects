<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,1:ImageSprite;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Content/Css:1&amp;amp;hashKey=E7560C71640616C5057FAEACB58DCB00" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/2f95808e-ca34-4249-88ff-44fabe33cdc0Combined.css,1:LinkList,2:ImageSprite,2:SiteFeedbackLink;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Themes/Base/Content:1,/Areas/Epx/Content/Css:2&amp;amp;hashKey=EEE39C2D6B93379FDAF50337BE99AF8C" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Handling Unhandled Exceptions in WPF (The most complete collection of handlers)</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Handling Unhandled Exceptions in WPF (The most complete collection of handlers)</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            C#, WPF, XAML
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Exception handling, Logging, Event Handling, Custom Exceptions, WPF Debugging, Unhandled Events, Unhandled Event Handler, Faultfinding WPF, Unhandled Exceptions, WPF Bugs
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary Language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Last Updated</label>
                    <div id="LastUpdated">9/23/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Handling-Unhandled-47492d0b">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy Code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>This is the ultimate collection of unhandled exception event handlers for WPF. There are FIVE different&nbsp;event handlers you can call upon to catch that ellusive bug, before you application dies. Examples of each are shown, with&nbsp;how to catch, handle,
 log and usually overcome the critical events.</p>
<p><img id="67146" src="description/exc.png" alt="" width="636" height="335"></p>
<p>&nbsp;</p>
<h1><span>Building &amp; Running the Sample</span></h1>
<p>Just download, unzip, open and build!</p>
<p><span style="color:#ff0000"><strong>Note</strong>: Because this is an exception handling demo, you will need to either:</span></p>
<p><span style="color:#ff0000">A) Keep pressing F5, to continue past&nbsp;each debugger catch</span></p>
<p><span style="color:#ff0000">B) <strong><span style="text-decoration:underline">Build</span> the project and
<span style="text-decoration:underline">run from the exe</span> in bin/debug folder</strong>.</span></p>
<p>&nbsp;</p>
<h1><span style="font-size:20px">Description</span></h1>
<p>This project contains everything you need to handle&nbsp;just about every unhandled exception in WPF.</p>
<p>&nbsp;</p>
<h2>1. AppDomain.CurrentDomain.FirstChanceException</h2>
<p>This is new to .Net 4 and is extremely useful for ensuring that you ALWAYS log SOMETHING. Whenever any kind of exception is fired in your application, a FirstChangeExcetpion is raised, even if the exception was within a Try/Catch block and safely handled.
 This is GREAT for logging every wart and boil, but can often result in too much spam, if your application&nbsp;has a lot of expected/handled exceptions.
<strong>In this example, because&nbsp;this handler&nbsp;is active, it will fire for every example, before the other handler reacts.</strong></p>
<p>&nbsp;</p>
<h2>2. Application.DispatcherUnhandledException</h2>
<p>This is the main exception event for most application unhandled exceptions. It also has a Handled property with which you can try to recover and continue after the exception.</p>
<p>&nbsp;</p>
<h2>3. AppDomain.CurrentDomain.UnhandledException</h2>
<p>Although Application.DispatcherUnhandledException covers most issues in the current AppDomain, in extremely rare circumstances, you may be running a thread on a second AppDomain. This event&nbsp;conveys the other AppDomain unhandled exception, but there
 are no Handled property, just an IsTerminating flag.</p>
<p>&nbsp;</p>
<h2>4. TaskScheduler.UnobservedTaskException</h2>
<p>If you are using Tasks, then you may have &quot;unobserved task exceptions&quot;. This event allows you to trap them. It also has a method called SetObserved, which allows you to try to recover from the issue.</p>
<p>&nbsp;</p>
<h2>5. <a class="libraryLink" href="http://msdn.microsoft.com/en-US/library/System.Windows.Forms.Application.ThreadException.aspx"  title="Auto generated link to System.Windows.Forms.Application.ThreadException">System.Windows.Forms.Application.ThreadException</a></h2>
<p>If you are hosting any WinForm componants in your WPF application, this final event is one to watch. There's no way to influence events thereafter, but at least you get to see what the problem was.</p>
<p>&nbsp;</p>
<h2>Logging Exceptions and Inner Exceptions.</h2>
<p>Inner exceptions are very commonly used in WPF, as XAML errors (like missing resources) are often more meaningfully detailed in the Inner Exception. All of the event handlers for the events above use one logging function, shown below:</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">class Log
{
    static Log log;

    private Log() { }

    public static Log GetInstance()
    {
        if (log == null)
            log = new Log();
        return log;
    }

    internal void ProcessError(Exception exception)
    {
        var error = &quot;LOGGED: Exception = &quot; &#43; exception.Message;

        while (exception.InnerException != null)
        {
            exception = exception.InnerException;
            error &#43;= &quot; : Inner Exception = &quot; &#43; exception.Message;
        }

        //This is where you save to file.

        MessageBox.Show(error);
    }
}</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">class</span>&nbsp;Log&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">static</span>&nbsp;Log&nbsp;log;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">private</span>&nbsp;Log()&nbsp;{&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">public</span>&nbsp;<span class="cs__keyword">static</span>&nbsp;Log&nbsp;GetInstance()&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">if</span>&nbsp;(log&nbsp;==&nbsp;<span class="cs__keyword">null</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;Log();&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;log;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">internal</span>&nbsp;<span class="cs__keyword">void</span>&nbsp;ProcessError(Exception&nbsp;exception)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;error&nbsp;=&nbsp;<span class="cs__string">&quot;LOGGED:&nbsp;Exception&nbsp;=&nbsp;&quot;</span>&nbsp;&#43;&nbsp;exception.Message;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">while</span>&nbsp;(exception.InnerException&nbsp;!=&nbsp;<span class="cs__keyword">null</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception&nbsp;=&nbsp;exception.InnerException;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;&#43;=&nbsp;<span class="cs__string">&quot;&nbsp;:&nbsp;Inner&nbsp;Exception&nbsp;=&nbsp;&quot;</span>&nbsp;&#43;&nbsp;exception.Message;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//This&nbsp;is&nbsp;where&nbsp;you&nbsp;save&nbsp;to&nbsp;file.</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox.Show(error);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
}</pre>
</div>
</div>
</div>
<p><img src="description/aniThanks1.gif" alt="" style="margin-right:auto; margin-left:auto; display:block"></p>

</div>


    </div>
</body>
</html>
